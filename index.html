<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Quiz Express</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f4f4;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    h1 { color: #6b5b95; }
    button {
      margin: 10px 0;
      padding: 10px 20px;
      background: #6b5b95;
      color: white;
      border: none;
      cursor: pointer;
    }
    .question { margin-top: 20px; }
  </style>
</head>
<body>

<h1>üéì Quiz Express</h1>
<div id="quiz-container"></div>
<div id="result"></div>
<div id="share-buttons" style="display:none;">
  <button onclick="generateScoreImage(finalScore, totalQuestions)">üì∏ T√©l√©charger mon score</button>
  <button onclick="navigator.clipboard.writeText(window.location.href)">üîó Copier le lien du quiz</button>
</div>

<script>
  // Exemple de quiz
  const sampleQuiz = [
    { question: "Quelle est la capitale de la France ?", options: ["Paris", "Lyon", "Marseille"], answer: 0 },
    { question: "Combien font 2 + 2 ?", options: ["3", "4", "5"], answer: 1 },
    { question: "Quel langage utilise HTML ?", options: ["Marqu√©", "Programmation", "Compilation"], answer: 0 }
  ];

  let finalScore = 0;
  let totalQuestions = 0;

  // G√©n√©rer le quiz encod√© dans l'URL
  function generateQuizURL() {
    const payload = {
      createdAt: Date.now(),
      questions: sampleQuiz
    };
    const encoded = encodeURIComponent(JSON.stringify(payload));
    const url = `${location.origin}${location.pathname}?quiz=${encoded}`;
    navigator.clipboard.writeText(url);
    alert("Lien du quiz copi√© !");
  }

  // Afficher le quiz
  function startQuiz(questions) {
    const container = document.getElementById('quiz-container');
    container.innerHTML = '';
    totalQuestions = questions.length;
    let score = 0;

    questions.forEach((q, i) => {
      const div = document.createElement('div');
      div.className = 'question';
      div.innerHTML = `<strong>${q.question}</strong><br>`;
      q.options.forEach((opt, j) => {
        const btn = document.createElement('button');
        btn.textContent = opt;
        btn.onclick = () => {
          if (j === q.answer) score++;
          if (i === questions.length - 1) {
            finalScore = score;
            showResult(score, questions.length);
          } else {
            div.style.display = 'none';
            container.children[i + 1].style.display = 'block';
          }
        };
        div.appendChild(btn);
      });
      container.appendChild(div);
      if (i > 0) div.style.display = 'none';
    });
  }

  // Afficher le score
  function showResult(score, total) {
    document.getElementById('result').innerHTML = `<h2>‚úÖ Score : ${score}/${total}</h2>`;
    document.getElementById('share-buttons').style.display = 'block';
  }

  // G√©n√©rer une image avec le score
  function generateScoreImage(score, total) {
    const canvas = document.createElement('canvas');
    canvas.width = 600;
    canvas.height = 300;
    const ctx = canvas.getContext('2d');

    ctx.fillStyle = '#6b5b95';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = '#fff';
    ctx.font = 'bold 32px Segoe UI';
    ctx.textAlign = 'center';
    ctx.fillText(`üéâ J'ai obtenu ${score}/${total} !`, canvas.width / 2, canvas.height / 2);

    const imgURL = canvas.toDataURL('image/png');
    const link = document.createElement('a');
    link.href = imgURL;
    link.download = 'mon_score.png';
    link.click();
  }

  // Lecture du quiz depuis l'URL
  const params = new URLSearchParams(location.search);
  if (params.has('quiz')) {
    try {
      const data = JSON.parse(decodeURIComponent(params.get('quiz')));
      const age = Date.now() - data.createdAt;
      if (age > 86400000) {
        document.getElementById('quiz-container').innerHTML = "<p>‚è≥ Ce quiz a expir√©.</p>";
      } else {
        startQuiz(data.questions);
      }
    } catch (e) {
      document.getElementById('quiz-container').innerHTML = "<p>‚ö†Ô∏è Quiz invalide.</p>";
    }
  } else {
    // Si pas de quiz dans l'URL, proposer de g√©n√©rer un
    const btn = document.createElement('button');
    btn.textContent = "üéØ G√©n√©rer un quiz √† partager";
    btn.onclick = generateQuizURL;
    document.getElementById('quiz-container').appendChild(btn);
  }
</script>

</body>
</html>