<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Créateur de Quiz Amusant</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f7fa; /* Ton bleu clair convivial */
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            text-align: center;
            color: #333;
        }
        .container {
            background: #ffffff;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            max-width: 100%;
            width: 600px;
        }
        h1 {
            color: #4a90e2; /* Bleu convivial */
            font-size: 24px;
            margin-bottom: 20px;
        }
        h2 {
            color: #27ae60; /* Vert pour l'amusement */
            font-size: 20px;
        }
        input, select {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background-color: #4a90e2;
            color: white;
            border: none;
            padding: 12px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #357abd;
        }
        .question-block {
            background: #e8f4fd; /* Fond bleu clair pour questions */
            padding: 15px;
            margin: 15px 0;
            border-radius: 10px;
            border: 1px solid #c9e1f8;
        }
        .option-input {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        .option-input input[type="text"] {
            flex: 1;
            margin-right: 10px;
        }
        .option-input input[type="radio"] {
            margin-right: 5px;
        }
        #questions-container {
            margin-bottom: 20px;
        }
        #result, #quiz-player {
            margin-top: 20px;
            padding: 15px;
            background-color: #d9f2e6; /* Vert clair pour résultats */
            border-radius: 10px;
            display: none;
        }
        .share-buttons {
            margin-top: 20px;
        }
        .share-button {
            display: inline-block;
            margin: 5px;
            padding: 10px 15px;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 14px;
        }
        .facebook { background-color: #3b5998; }
        .instagram { background-color: #e1306c; }
        .whatsapp { background-color: #25d366; }
        .twitter { background-color: #1da1f2; }

        /* Responsive pour écrans mobiles */
        @media (max-width: 600px) {
            .container {
                width: 100%;
                padding: 20px;
            }
            body {
                padding: 10px;
            }
            h1 {
                font-size: 20px;
            }
            button, input, select {
                font-size: 14px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="creator-mode">
        <h1>Créateur de Quiz Amusant !</h1>
        <p>Crée un quiz fun sur toi, tes amis ou un thème rigolo. Ajoute autant de questions que tu veux, puis partage le lien pour que tes contacts jouent et voient leur score !</p>
        
        <input type="text" id="quiz-title" placeholder="Titre du Quiz (ex: Quiz sur Moi !)" required>
        
        <div id="questions-container"></div>
        
        <button onclick="addQuestion()">Ajouter une Question</button>
        <button onclick="generateQuiz()">Générer et Partager le Quiz !</button>
        
        <div id="result">
            <h2>Quiz Généré !</h2>
            <p>Copie ce lien et partage-le. Tes amis pourront jouer directement !</p>
            <textarea id="quiz-link" rows="3" readonly></textarea>
            <div class="share-buttons">
                <a id="shareFb" class="share-button facebook" href="#" target="_blank">Partager sur Facebook</a>
                <a id="shareIg" class="share-button instagram" href="#" target="_blank">Partager sur Instagram</a>
                <a id="shareWa" class="share-button whatsapp" href="#" target="_blank">Partager sur WhatsApp</a>
                <a id="shareTw" class="share-button twitter" href="#" target="_blank">Partager sur X</a>
            </div>
        </div>
    </div>

    <div class="container" id="player-mode">
        <h1 id="player-title"></h1>
        <div id="quiz-questions"></div>
        <button onclick="submitQuiz()">Soumettre les Réponses</button>
        <div id="quiz-result" style="display: none;">
            <h2>Ton Score :</h2>
            <p id="score"></p>
        </div>
    </div>

    <script>
        let questionCount = 0;

        // Fonction pour ajouter une question
        function addQuestion() {
            questionCount++;
            const container = document.getElementById('questions-container');
            const questionBlock = document.createElement('div');
            questionBlock.className = 'question-block';
            questionBlock.innerHTML = `
                <h2>Question ${questionCount}</h2>
                <input type="text" class="q-text" placeholder="La question (ex: Quelle est ma couleur préférée ?)" required>
                <div class="options">
                    <p>Sélectionne la bonne réponse en cliquant sur le rond à gauche :</p>
                    <div class="option-input">
                        <input type="radio" name="correct-q-${questionCount}" value="0" required>
                        <input type="text" class="option" placeholder="Option 1" required>
                    </div>
                    <div class="option-input">
                        <input type="radio" name="correct-q-${questionCount}" value="1">
                        <input type="text" class="option" placeholder="Option 2" required>
                    </div>
                    <div class="option-input">
                        <input type="radio" name="correct-q-${questionCount}" value="2">
                        <input type="text" class="option" placeholder="Option 3" required>
                    </div>
                    <div class="option-input">
                        <input type="radio" name="correct-q-${questionCount}" value="3">
                        <input type="text" class="option" placeholder="Option 4" required>
                    </div>
                </div>
            `;
            container.appendChild(questionBlock);
        }

        // Fonction pour générer le quiz
        function generateQuiz() {
            const title = document.getElementById('quiz-title').value.trim();
            if (!title) {
                alert('Ajoute un titre au quiz !');
                return;
            }

            const questions = [];
            const questionBlocks = document.querySelectorAll('.question-block');
            if (questionBlocks.length === 0) {
                alert('Ajoute au moins une question !');
                return;
            }

            let isValid = true;
            questionBlocks.forEach((block, index) => {
                const qText = block.querySelector('.q-text').value.trim();
                const options = Array.from(block.querySelectorAll('.option')).map(opt => opt.value.trim());
                const correct = block.querySelector(`input[name="correct-q-${index+1}"]:checked`);
                
                if (!qText || options.some(opt => !opt) || !correct) {
                    alert(`Complète la question ${index + 1} correctement (question, options ET bonne réponse) !`);
                    isValid = false;
                    return;
                }
                questions.push({ q: qText, opts: options, correct: parseInt(correct.value) });
            });

            if (!isValid) return;

            // Encoder les données en Base64 pour l'URL
            const quizData = { title, questions };
            const encodedData = btoa(unescape(encodeURIComponent(JSON.stringify(quizData)))); // Gestion des caractères spéciaux
            const baseUrl = window.location.href.split('?')[0];
            const quizUrl = `${baseUrl}?quiz=${encodedData}`;

            document.getElementById('quiz-link').value = quizUrl;
            document.getElementById('result').style.display = 'block';

            // Liens de partage
            const shareText = encodeURIComponent(`Viens jouer à mon quiz amusant "${title}" et vois ton score !`);
            const shareUrl = encodeURIComponent(quizUrl);
            
            document.getElementById('shareFb').href = `https://www.facebook.com/sharer/sharer.php?u=${shareUrl}&quote=${shareText}`;
            document.getElementById('shareWa').href = `https://wa.me/?text=${shareText} ${shareUrl}`;
            document.getElementById('shareTw').href = `https://twitter.com/intent/tweet?text=${shareText}&url=${shareUrl}`;
            // Instagram ne permet pas de partage direct via URL, donc on peut simplement mettre un message
            document.getElementById('shareIg').href = `https://www.instagram.com/`;
        }

        // Fonction pour soumettre le quiz en mode Jeu
        function submitQuiz() {
            const urlParams = new URLSearchParams(window.location.search);
            const encodedData = urlParams.get('quiz');
            if (!encodedData) return;

            const quizData = JSON.parse(decodeURIComponent(escape(atob(encodedData))));

            let score = 0;
            const questionBlocks = document.querySelectorAll('#quiz-questions .question-block');
            
            let allAnswered = true;
            for (let i = 0; i < questionBlocks.length; i++) {
                const selected = document.querySelector(`input[name="answer-${i}"]:checked`);
                if (!selected) {
                    allAnswered = false;
                    break;
                }
                if (parseInt(selected.value) === quizData.questions[i].correct) {
                    score++;
                }
            }

            if (!allAnswered) {
                alert('Réponds à toutes les questions avant de soumettre !');
                return;
            }

            document.getElementById('score').textContent = `Tu as ${score} sur ${quizData.questions.length} bonnes réponses ! Amuse-toi bien et partage ton score.`;
            document.getElementById('quiz-result').style.display = 'block';
        }

        // Fonction pour initialiser l'app au chargement de la page
        function init() {
            const urlParams = new URLSearchParams(window.location.search);
            const encodedData = urlParams.get('quiz');

            document.getElementById('creator-mode').style.display = 'none';
            document.getElementById('player-mode').style.display = 'none';

            if (encodedData) {
                // Mode Jeu
                document.getElementById('player-mode').style.display = 'block';
                try {
                    const quizData = JSON.parse(decodeURIComponent(escape(atob(encodedData))));
                    document.getElementById('player-title').textContent = quizData.title;

                    const questionsContainer = document.getElementById('quiz-questions');
                    questionsContainer.innerHTML = ''; // Nettoyer pour éviter les doublons
                    quizData.questions.forEach((q, index) => {
                        const qDiv = document.createElement('div');
                        qDiv.className = 'question-block';
                        qDiv.innerHTML = `
                            <h2>${q.q}</h2>
                            ${q.opts.map((opt, optIndex) => `
                                <div class="option-input">
                                    <input type="radio" name="answer-${index}" value="${optIndex}" required>
                                    <label>${opt}</label>
                                </div>
                            `).join('')}
                        `;
                        questionsContainer.appendChild(qDiv);
                    });
                } catch (e) {
                    alert('Quiz invalide ! Erreur de décodage.');
                    console.error(e);
                    // En cas d'erreur, revenir au mode création
                    window.location.href = window.location.href.split('?')[0];
                }
            } else {
                // Mode Création par défaut
                document.getElementById('creator-mode').style.display = 'block';
            }
        }

        // Ajout de la première question au démarrage pour que l'utilisateur puisse commencer immédiatement
        document.addEventListener('DOMContentLoaded', () => {
            init();
            if (!new URLSearchParams(window.location.search).get('quiz')) {
                addQuestion();
            }
        });
    </script>
</body>
</html>
