<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>CrÃ©ateur de QCM Amusant</title>
  <style>
    /*â€“â€“ reset & typo â€“â€“*/
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Segoe UI', sans-serif; background: #f0f8ff; color: #333; line-height: 1.4; padding: 20px; }
    h1 { text-align: center; margin-bottom: 20px; color: #6b5b95; }
    button { cursor: pointer; border: none; border-radius: 4px; padding: 10px 16px; font-size: 1rem; }
    button:hover { opacity: .9; }

    /*â€“â€“ containers â€“â€“*/
    #builder, #quiz-container { max-width: 600px; margin: 0 auto; }
    .question-form, .quiz-card { background: #fff; border-radius: 8px; padding: 16px; margin-bottom: 16px; box-shadow: 0 2px 6px rgba(0,0,0,.1); }

    /*â€“â€“ builder â€“â€“*/
    .question-form input[type="text"] { width: 100%; padding: 8px; margin-bottom: 8px; border: 1px solid #ccc; border-radius: 4px; }
    .answers { margin-left: 16px; }
    .answer-item { display: flex; align-items: center; margin-bottom: 6px; }
    .answer-item input[type="text"] { flex: 1; padding: 6px; margin-left: 6px; margin-right: 6px; border: 1px solid #ccc; border-radius: 4px; }
    .answer-item button { background: #ff6f61; color: #fff; padding: 4px 8px; }

    #add-question-btn { background: #88b04b; color: #fff; margin-bottom: 20px; }
    #generate-btn    { background: #6b5b95; color: #fff; width: 100%; }

    /*â€“â€“ quiz â€“â€“*/
    .quiz-card h2 { margin-bottom: 12px; color: #333; }
    .quiz-card .options { list-style: none; }
    .quiz-card .options li { margin-bottom: 8px; }
    .quiz-card .options button { width: 100%; background: #6b5b95; color: #fff; }

    #score-screen { text-align: center; }
    #share-btn { background: #ff6f61; color: #fff; margin-top: 12px; }
    #restart-btn { background: #88b04b; color: #fff; margin-top: 8px; }

    /*â€“â€“ hidden â€“â€“*/
    .hidden { display: none; }
  </style>
</head>
<body>

  <h1>CrÃ©ateur de QCM Amusant</h1>

  <!-- CONSTRUCTEUR DE QUIZ -->
  <div id="builder">
    <div id="questions-container"></div>
    <button id="add-question-btn">âž• Ajouter une question</button>
    <button id="generate-btn">ðŸŽ‰ GÃ©nÃ©rer le quiz</button>
  </div>

  <!-- JEU DE QUIZ -->
  <div id="quiz-container" class="hidden">
    <!-- questions seront injectÃ©es ici -->
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', ()=> {
    const builder      = document.getElementById('builder');
    const qContainer   = document.getElementById('questions-container');
    const addQBtn      = document.getElementById('add-question-btn');
    const genBtn       = document.getElementById('generate-btn');
    const quizCont     = document.getElementById('quiz-container');
    let questionCount  = 0;

    // Fonction pour crÃ©er un bloc question
    function addQuestion(data) {
      const qIdx = questionCount++;
      const form = document.createElement('div');
      form.className = 'question-form';
      form.dataset.idx = qIdx;
      form.innerHTML = `
        <label>Question ${qIdx+1} :</label>
        <input type="text" class="question-text" placeholder="Ã‰crivez votre question" value="${data?.question||''}">
        <div class="answers"></div>
        <button class="add-answer-btn" type="button">âž• Ajouter une rÃ©ponse</button>
        <button class="remove-question-btn" type="button" style="background:#ff6f61;color:#fff;margin-top:8px;">ðŸ—‘ Supprimer la question</button>
      `;
      // Ajout du premier champ de rÃ©ponse par dÃ©faut
      const ansContainer = form.querySelector('.answers');
      function newAnswer(text, correct) {
        const aIdx = ansContainer.children.length;
        const div = document.createElement('div');
        div.className = 'answer-item';
        div.innerHTML = `
          <input type="radio" name="correct-${qIdx}" ${correct? 'checked':''}>
          <input type="text" placeholder="Texte de la rÃ©ponse" value="${text||''}">
          <button type="button" title="Supprimer cette rÃ©ponse">âœ–</button>
        `;
        // suppression
        div.querySelector('button').onclick = ()=> div.remove();
        ansContainer.append(div);
      }
      form.querySelector('.add-answer-btn').onclick = ()=> newAnswer();
      form.querySelector('.remove-question-btn').onclick = ()=> form.remove();
      // si on passe des donnÃ©es existantes
      if(data) {
        data.answers.forEach((t,i)=> newAnswer(t, i===data.correct));
      } else {
        newAnswer('', false);
        newAnswer('', false);
      }
      qContainer.append(form);
    }

    // Initialisation
    addQuestion();

    addQBtn.onclick = ()=> addQuestion();

    // GÃ©nÃ©rer et lancer le quiz
    genBtn.onclick = ()=> {
      const forms = qContainer.querySelectorAll('.question-form');
      if(forms.length===0) return alert('Ajoutez au moins une question.');
      const quizData = [];
      for(const f of forms) {
        const qText = f.querySelector('.question-text').value.trim();
        const ansEls = [...f.querySelectorAll('.answer-item')];
        const answers = ansEls.map(a=> a.querySelector('input[type="text"]').value.trim());
        const correct = ansEls.findIndex(a=> a.querySelector('input[type="radio"]').checked);
        if(!qText||answers.some(a=>!a)||correct<0) {
          return alert('Chaque question doit avoir du texte, au moins deux rÃ©ponses et une rÃ©ponse correcte.');
        }
        quizData.push({ question: qText, answers, correct });
      }
      startQuiz(quizData);
    };

    // Lecture du quiz partagÃ© via URL
    const params = new URLSearchParams(location.search);
    if(params.has('quiz')) {
      try {
        const data = JSON.parse(decodeURIComponent(params.get('quiz')));
        builder.classList.add('hidden');
        startQuiz(data);
      } catch(e){}
    }

    // Affichage et gestion du quiz
    function startQuiz(questions) {
      builder.classList.add('hidden');
      quizCont.innerHTML = '';
      quizCont.classList.remove('hidden');
      let idx=0, score=0;

      function showNext() {
        quizCont.innerHTML = '';
        if(idx>=questions.length) {
          const end = document.createElement('div');
          end.id = 'score-screen';
          end.innerHTML = `
            <h2>ðŸŽ‰ Votre score : ${score} / ${questions.length}</h2>
            <button id="share-btn">ðŸ”— Partager ce quiz</button>
            <button id="restart-btn">ðŸ”„ Recommencer</button>
          `;
          quizCont.append(end);
          document.getElementById('restart-btn').onclick = ()=> location.reload();
          document.getElementById('share-btn').onclick = shareQuiz;
          return;
        }
        const q = questions[idx];
        const card = document.createElement('div');
        card.className = 'quiz-card';
        card.innerHTML = `<h2>Q${idx+1}. ${q.question}</h2><ul class="options"></ul>`;
        const ul = card.querySelector('.options');
        q.answers.forEach((txt,i)=>{
          const li = document.createElement('li');
          const btn= document.createElement('button');
          btn.textContent = txt;
          btn.onclick = ()=>{
            if(i===q.correct) score++;
            idx++;
            showNext();
          };
          li.append(btn);
          ul.append(li);
        });
        quizCont.append(card);
      }
      showNext();

      // Fonction de partage
      function shareQuiz() {
        const payload = encodeURIComponent(JSON.stringify(questions));
        const shareURL = location.origin + location.pathname + '?quiz=' + payload;
        if(navigator.share) {
          navigator.share({ title:'Mon QCM Amusant', text:'Teste mon quiz !', url:shareURL });
        } else {
          navigator.clipboard.writeText(shareURL)
            .then(()=> alert('Lien copiÃ© dans le presse-papier !'))
            .catch(()=> prompt('Copiez ce lien :', shareURL));
        }
      }
    }
  });
  </script>

</body>
</html>